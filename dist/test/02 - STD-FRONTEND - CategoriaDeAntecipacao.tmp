/* 
 * Filename : 02 - STD-FRONTEND - CategoriaDeAntecipacao.sql
 * Author   : josemarsilva@inmetrics.com.br
 * Date     : 2019-02-14
 * Premissas: 
 *            * Layout obtido em 07/11/2018:
 *              - Formato: (.xlsx)
 *              - Colunas: "Número do Cliente", "Categoria (Em caso de inclusão, o nome da categoria) – Categoria: “A” "em caso de excluir CAT Manual " ")", "Solicitante (Cielo ou Cliente)", "Nome do Solicitante", "Ação (Inclusão ou Exclusão de categorial manual) – Indicador “I” ou “E”", "Comentário"
 *              - Regras:
 *                - EC's reservados para StressTest, transacionados pelo GeradorMassa ( dt_batch, nu_load_file)
 *                - EC; Obrigatório para Ação = "I" (não preencher se "E"); Cielo ou Cliente; I = Inclusão / E=exclusão;
 *                - EC's individual ou raiz do grupo comercial ( raiz de CNPJ)
 *              - Exemplo de massa:
 *                Número do Cliente | Categoria | Solicitante | Nome do Solicitante | Ação | Comentário                   |
 *                2004242730        | C         | Cliente     | Burin               | I    | Solicitado por Mesa Corparte |
 *                2004242234        | C         | Clielo      | Mauri               | I    | Solicitado por Mesa Middle   |
 *              - Domínio de valores e significado de "Número do Cliente" (obrigatório): EC
 *              - Domínio de valores e significado de "Categoria" (obrigatório para ação I; não preencher para ação E): 1 - Regularizações; 2 - Cobrança
 *              - Domínio de valores e significado de "Solicitante" (não obrigatório): Cliente; Cielo
 *              - Domínio de valores e significado de "Nome do Solicitante" (não obrigatório): Burin; Mauri
 *              - Domínio de valores e significado de "Ação" (obrigatório): I = Inclusão; E=exclusão
 *              - Domínio de valores e significado de "Comentário" (não obrigatório): alfanumerico
 *            * Fluxo de negócio: representa uma classificação de cliente, isto é dizer se ele é bom pagador, ou não
 */
 
 SELECT TO_CHAR(m.nu_customer)                              AS "Numero do Cliente",
        DECODE( MOD(TO_NUMBER(TO_CHAR(SYSDATE,'d')),7),
         1, 'A',
         2, 'B',
         3, 'C',
         4, 'D',
         5, 'E',
         6, 'F',
            'G'
        )                                                   AS "Categoria",
        DECODE( MOD(m.nu_customer,2), 0, 'Cliente', 'Clielo')
                                                            AS "Solicitante (Cielo ou Cliente)",
        DECODE( MOD(m.nu_customer,2), 0, 'Burin', 'Mauri')
                                                            AS "Nome do Solicitante",
        'I'                                                 AS "Acao (I-Inclusao ou E-Exclusao de categorial manual)", 
        DECODE( MOD(m.nu_customer,2), 0, 'Solicitado por Mesa Corparte', 'Solicitado por Mesa Middle')
        || '; Raiz Cnpj: ' || rcn.nu_root_cnpj_cpf
                                                            AS "Comentario"
 FROM   TBCTMR_MERCHANT             m,
        TBHRQR_ROOT_CNPJ_NODE       rcn
 WHERE  1=1
        /* Join */ 
 AND    rcn.dt_hierarchy_reference = TRUNC(SYSDATE)
 AND    rcn.nu_customer = m.nu_customer
        /* Condition */ 
 AND    EXISTS
        (
          SELECT 'X' FROM PERFSTAR.PERF_CLIENTE_TRANSACAO perf WHERE  perf.nu_customer = m.nu_customer
        )
        /* Limit Rows */ 
 AND    ROWNUM <= 200000
 AND    ROWNUM <= 10000 /* e-mail Nilton Amancio 22/02 */
        /* Order By */ 
 ORDER  BY m.nu_customer

 